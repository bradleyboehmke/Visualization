---
title: "Histograms"
author: NULL
date: NULL
output:
  html_document:
    keep_md: true
    fig_width: 4
    fig_height: 3
---

Histograms are a useful way to look at the shape of a distribution of numerical data and are, typically, our first step in assessing normality. They are used by displaying the numeric values on the x-axis where the continuous variable is broken into intervals (aka bins) and the the y-axis represents the frequency or percent of observations that fall into that bin. Density plots provide a similar plot; however, the y-axis displays the probability of getting an x value.

- [Replication requirements](#replication)
- [Basic histogram & density plot](#basics)
- [Comparing groups](#groups)
- [Adding value markers](#markers)

<br>

## Relication Requirements {#replication}
We'll illustrate with the following data:

```{r}
set.seed(1234)

df <- data.frame(group = factor(rep(c("A", "B"), each = 200)),
                 rating = c(rnorm(200), rnorm(200, mean = .8)))
```

Although histograms can be produced quickly with base R functions and `ggplot2`'s `qplot()` function, for this tutorial I will demonstrate how to generate more refined histograms with `ggplot2`s full syntax.

```{r}
library(ggplot2)
```

<br>

## Basic Histogram & Density Plot {#basics}
The basic histogram assesses the frequency or count of individual x intervals. 

```{r, fig.align='center'}
# default histogram
ggplot(df, aes(x = rating)) +
        geom_histogram()

# Change colors for better distinction and adjust bin width
ggplot(df, aes(x = rating)) +
        geom_histogram(binwidth = .3, color = "grey30", fill = "white")
```

To visualize the density of the distribution instead of the count:

```{r, fig.align='center'}
# default density plot
ggplot(df, aes(x = rating)) +
        geom_density()

# get the density histogram
ggplot(df, aes(x = rating)) +
        geom_histogram(aes(y = ..density..), 
                     binwidth = .3, color = "grey30", fill = "white")

# overlay the histogram & density plot
ggplot(df, aes(x = rating)) +
        geom_histogram(aes(y = ..density..), 
                     binwidth = .3, color = "grey30", fill = "white") +
        geom_density()

# fill density overlay with transparent color
ggplot(df, aes(x = rating)) +
        geom_histogram(aes(y = ..density..), 
                     binwidth = .3, color = "grey30", fill = "white") +
        geom_density(alpha = .2, fill = "antiquewhite3")
```

<a href="#top">Go to top</a>

<br>

## Comparing Groups {#groups}
Often, we want to compare the distributions of different groups within our data.  To compare the histograms and density plots of multiple groups we can do the following:

```{r, fig.align='center'}
# Overlaying histograms
ggplot(df, aes(x = rating, fill = group)) +
        geom_histogram(binwidth = .3, alpha = .5, position = "identity")

# Interweaving histograms
ggplot(df, aes(x = rating, fill = group)) +
        geom_histogram(binwidth = .3, position = "dodge")

# Overlaying density plots
ggplot(df, aes(x = rating, fill = group)) +
        geom_density(alpha = .5)
```


We can also separate the histograms by using facets:

```{r, fig.align='center', fig.height=5, fig.width=5}
# vertical faceting
ggplot(df, aes(x = rating)) +
        geom_histogram(binwidth = .3, color = "grey30", fill = "white") +
        facet_grid(group ~ .)
```

```{r, fig.align='center', fig.height=4, fig.width=6}
# horizontal faceting
ggplot(df, aes(x = rating)) +
        geom_histogram(binwidth = .3, color = "grey30", fill = "white") +
        facet_grid(. ~ group)
```


<a href="#top">Go to top</a>

<br>

## Add Value Markers {#markers}
We can also add markers to indicate important values such as the mean or median:

```{r, fig.align='center'}
# Add mean line to single histogram
ggplot(df, aes(x = rating)) +
        geom_histogram(binwidth = .3, color = "grey30", fill = "white") +
        geom_vline(aes(xintercept = mean(rating, na.rm = TRUE)),
                    color = "red", linetype = "dashed", size = 1)
```

To add lines for grouped data we need to do a little computation prior to graphing.  Here we simple create a new data frame with the mean values for each group and use that data to plot the mean lines:

```{r, fig.align='center', warning=FALSE, message=FALSE, fig.width=5}
library(dplyr)

# calculate mean for each group
df_mean <- df %>%
        group_by(group) %>%
        summarise(Avg = mean(rating, na.rm = TRUE))

# Add mean line to overlaid histograms
ggplot(df, aes(x = rating, fill = group)) +
        geom_histogram(binwidth = .3, alpha = .5, position = "identity") +
        geom_vline(data = df_mean, aes(xintercept = Avg, color = group),
                   linetype = "dashed", size = 1)
```

```{r, fig.align='center', fig.height=4, fig.width=6}
# Add mean line to faceted histograms
ggplot(df, aes(x = rating)) +
        geom_histogram(binwidth = .3, color = "grey30", fill = "white") +
        facet_grid(. ~ group) +
        geom_vline(data = df_mean, aes(xintercept = Avg), 
                   linetype = "dashed", size = 1, color = "red")
```

<a href="#top">Go to top</a>

<br>





