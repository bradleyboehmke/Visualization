{
    "collab_server" : "",
    "contents" : "library(xlsx)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(magrittr)\n\n\n##################\n# Histogram icon #\n##################\n# basic histogram for icon\nrandom <- data.frame(x = rnorm(1000))\nggplot(random, aes(x)) +\n        geom_histogram(color = \"#EEEEEE\") +\n        theme_minimal() +\n        theme(plot.background = element_rect(fill = \"#EEEEEE\", color = \"#EEEEEE\"),\n              axis.text = element_blank(),\n              axis.ticks = element_blank(),\n              axis.title = element_blank(),\n              panel.grid.major = element_blank(),\n              panel.grid.minor = element_blank())\n\n# basic histogram for explanation\nggplot(random, aes(x)) +\n        geom_histogram(color = \"#fdfdfd\") +\n        theme_minimal() +\n        theme(plot.background = element_rect(fill = \"#fdfdfd\", color = \"#fdfdfd\"),\n              axis.text = element_blank(),\n              axis.ticks = element_blank(),\n              axis.title = element_blank(),\n              panel.grid.major = element_blank(),\n              panel.grid.minor = element_blank())\n\n\n# preset background color to my blogs background color\ntheme_update(plot.background = element_rect(fill = \"#fdfdfd\"))\n\n# read in PEW data\nincome <- read.xlsx(\"Middle-Class-U.S.-Metro-Areas-5-12-16-Supplementary-Tables.xlsx\",\n          sheetIndex = \"3. Median HH income, metro\",\n          startRow = 8, colIndex = c(1:5, 7:10)) %>%\n        set_colnames(c(\"Metro\", \"All_99\", \"Lower_99\", \"Middle_99\", \"Upper_99\",\n                       \"All_14\", \"Lower_14\", \"Middle_14\", \"Upper_14\")) %>%\n        filter(Metro != \"NA\")\n\n\n\n##################################\n# Basic Histogram & Density Plot #\n##################################\n# basic histogram\nggplot(income, aes(x = All_14)) +\n        geom_histogram()\n\n# add some color & adjust binwidth\nggplot(income, aes(x = All_14)) +\n        geom_histogram(binwidth = 2000, color = \"grey30\", fill = \"white\")\n\n# look at the density\nggplot(income, aes(x = All_14)) +\n        geom_density()\n\n# overlap density and histogram\nggplot(income, aes(x = All_14)) +\n        geom_histogram(aes(y = ..density..), \n                       binwidth = 2000, color = \"grey30\", fill = \"white\") +\n        geom_density(alpha = .2, fill = \"antiquewhite3\")\n\n####################\n# Comparing Groups #\n####################\ncompare <- income %>%\n        select(Metro, All_99, All_14) %>%\n        gather(Year, Income, All_99:All_14)\n\n# Overlaying histograms\nggplot(compare, aes(x = Income, fill = Year)) +\n        geom_histogram(binwidth = 2000, alpha = .5, position = \"identity\")\n\n# Interweaving histograms\nggplot(compare, aes(x = Income, fill = Year)) +\n        geom_histogram(binwidth = 2000, position = \"dodge\")\n\n# Overlaying density plots\nggplot(compare, aes(x = Income, fill = Year)) +\n        geom_density(alpha = .5)\n\n# We can also separate the histograms by using facets:\nggplot(compare, aes(x = Income)) +\n        geom_histogram(binwidth = 2000, color = \"grey30\", fill = \"white\") +\n        facet_grid(. ~ Year)\n\nggplot(compare, aes(x = Income)) +\n        geom_histogram(binwidth = 2000, color = \"grey30\", fill = \"white\") +\n        facet_grid(Year ~ .)\n\n# Let's compare the three classes from 1999 to 2014\nclass_comparison <- income %>%\n        select(Metro, Lower_99:Upper_99, Lower_14:Upper_14) %>%\n        gather(Class, Income, -Metro) %>%\n        separate(Class, into = c(\"Class\", \"Year\")) %>%\n        mutate(Year = ifelse(Year == 99, 1999, 2014))\n\nggplot(class_comparison, aes(x = Income)) +\n        geom_histogram(color = \"grey30\", fill = \"white\") +\n        facet_grid(Year ~ Class, scales = \"free\")\n\n\n########################\n# Adding Value Markers #\n########################\n# ADD A LINE TO A SINGLE HISTOGRAM\n# calculate mean for each group\nincome_mean <- df %>%\n        group_by(group) %>%\n        summarise(Avg = mean(rating, na.rm = TRUE))\n\n# Add median line to single histogram\nggplot(income, aes(x = All_14)) +\n        geom_histogram(binwidth = 2000, color = \"grey30\", fill = \"white\") +\n        geom_vline(xintercept = median(income$All_14))\n\n# Add median line to overlaid histograms\ncompare_median <- compare %>%\n        group_by(Year) %>%\n        summarise(Median = median(Income))\n\nggplot(compare, aes(x = Income, fill = Year)) +\n        geom_histogram(binwidth = 2000, alpha = .5, position = \"identity\") +\n        geom_vline(data = compare_median, aes(xintercept = Median, color = Year),\n                   linetype = \"dashed\", size = 1)\n\n# Add mean line to faceted histograms\nclass_median <- class_comparison %>%\n        group_by(Class, Year) %>%\n        summarise(Median = median(Income))\n\nggplot(class_comparison, aes(x = Income, fill = as.factor(Year))) +\n        geom_histogram() +\n        geom_vline(data = class_median, aes(xintercept = Median), linetype = \"dashed\") +\n        facet_grid(Year ~ Class, scales = \"free\")\n\n\n#####################\n# Finishing Touches #\n#####################\n\n# rename class\nclass_comparison$Class[class_comparison$Class == \"Lower\"] <- \"Lower Class\"\nclass_comparison$Class[class_comparison$Class == \"Middle\"] <- \"Middle Class\"\nclass_comparison$Class[class_comparison$Class == \"Upper\"] <- \"Upper Class\"\n\nclass_mean <- class_comparison %>%\n        group_by(Class, Year) %>%\n        summarise(Mean = mean(Income)) %>%\n        mutate(Label = paste0(\"$\", prettyNum(round(Mean, 0), big.mark = \",\")))\n\nggplot(class_comparison, aes(x = Income, fill = as.factor(Year))) +\n        geom_histogram(color = \"white\") +\n        geom_vline(data = class_mean, aes(xintercept = Mean), linetype = \"dashed\", alpha = .5) +\n        facet_grid(Year ~ Class, scales = \"free\") +\n        scale_x_continuous(labels = scales::dollar) +\n        scale_y_continuous(limits = c(0, 58), expand = c(0, 0)) +\n        ylab(\"Frequency\") +\n        xlab(\"\") +\n        labs(title = \"Median Household Income by Income Tier Across U.S. Metropolitan Areas\",\n             subtitle = \"Average median income across 229 metros decreased from $67,863 in 1999 to $62,662 in 2014, representing an 8% loss in income. \\nThe lower income class experienced the largest impact with a 11% decrease while the middle and upper class median household income \\ndecreased by 6% and 8% respectively.\",\n             caption = \"Source: Pew Research Center analysis of the 2000 decennial census and 2014 American Community Survey (IPUMS)\") +\n        geom_text(data = class_mean, aes(x = Mean, y = 52.5, id = Class, label = Label),\n                  family = \"Georgia\", size = 3, hjust = -.1) +\n        theme_bw() +\n        theme(legend.position = \"none\",\n              panel.margin.x = unit(2, \"lines\"),\n              panel.grid.minor = element_blank(),\n              axis.ticks = element_blank(),\n              axis.text.y = element_text(color = \"grey70\"),\n              axis.title.y = element_text(margin = margin(r = 25), color = \"grey70\"),\n              plot.title = element_text(size = 20, margin = margin(b = 10)),\n              plot.subtitle = element_text(size = 12, color = \"darkslategrey\", margin = margin(b = 25)),\n              plot.caption = element_text(size = 8, margin = margin(t = 20), color = \"grey70\", hjust = 0),\n              strip.text = element_text(size = 12),\n              text = element_text(family = \"Georgia\"))\n\n\n\n\n\n",
    "created" : 1464110509773.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "306958972",
    "id" : "A67CDBAF",
    "lastKnownWriteTime" : 1464033856,
    "last_content_update" : 1464033856,
    "path" : "~/Desktop/Personal/Education & Training/Personal Analyses/PEW Study - U.S. Metro Income/Median-HH-income-metro.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}